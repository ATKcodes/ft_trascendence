<html lang="en">
<head>
	<!-- Bootstrap CSS -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<title>PONG</title>
	<style>
	.select-language{
		background-color: #B6A999;
		color: #000000;
		position: absolute;
		right: 8%;
		top: 5%;
		width: 4%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: left;
	}
	.div-friends{
		position: absolute;
		right: 3%;
		bottom: 5%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;

	}
	.div-title {
		font-family: 'font-Despairs';
		font-size: 250%;
		position: absolute;
		left: 45%; /* Change this to move the div horizontally */
		right: 2%;
		top: 0%; /* Change this to move the div vertically */
		width: 15%;
		padding : 1%;
		color: black;
		}
	.div-friendsmenu {
		position: absolute;
		right: 5%;
		bottom: 3%;
		width: 15%;
		height: 40%;
		padding : 1%;
		margin: 0 auto;
		text-align: center;
		background-color: #B6A999;
	}
	.avatar {
		width: 4%;
		height: 5%;
		border-radius: 50%;
		font-weight: lighter;
		font-size :110%;
		color: #ffffff;
		position: absolute;
		left: 2%;
		top: 1.5%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		left: 1%;
	}
	.avatar2 {
		width: 4%;
		height: 5%;
		border-radius: 50%;
		font-weight: lighter;
		font-size :110%;
		color: #ffffff;
		position: absolute;
		right: 2%;
		top: 1.5%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		right: 1%;
	}
	.btn-left {
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		left: 20%;
		top: 45%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-left-top {
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		left: 20%;
		top: 40%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-left-bottom {
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		left: 20%;
		top: 50%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-right-top{
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		right: 20%;
		top: 40%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-right-bottom{
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		right: 20%;
		top: 50%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-right {
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		right: 20%;
		top: 45%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.btn-nohover:hover {
		visibility: visible !important;
        opacity: 1 !important;
	}
	.open_text {
		font-size: 200%;
		text-align: center;
		position: absolute;
		width: 60%;
		height: 75%;
		left: 20%;
		right: 2%;
		top: 20%;
		bottom: 10%;
		background-color: #000000;
		color: #ffffff;
	}
	.select {
		background-image: url('download.jpeg');
		border-radius: 50%;
		color: #000000;
		position: absolute;
		left: 3%;
		top: 5%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: left;
	}
	.dropdown {
		position: relative;
		display:flex;
		top: 5%;
	}
	.dropdown-menu {
		display: none;
		position: absolute;
		background-color: #f9f9f9;
		min-width: 160px;
		box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
		z-index: 1;
	}
	.dialog {
		display: none;
		background-color: #f9f9f9;
	}
	.userleft{
		position: absolute;
		left: 5%;
		top: 2.5%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
	}
	.userright{
		position: absolute;
		right: 5%;
		top: 2.5%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
	}
	#tris-game {
    	position: relative;
		width: 96%;
		height: 90%;
		left: 2%;
		right: 2%;
		top: 8%;
		bottom: 10%;
		background-color: #000000;
		color: #ffffff;
	    border: 1px solid black;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	#bottom-board {
		position: relative;
		width: 96%;
		height: 90%;
		left: 2%;
		right: 2%;
		top: 8%;
		bottom: 10%;
		background-color: #000000;
		color: #ffffff;
	    border: 1px solid black;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	#board {
		width: 49%;
		height: 74%;
		border-collapse: collapse;
		margin: 0 auto;
		position: relative;
		top: 10%
	}
	.cell {
            width: 30%;
            height: 30%;
            border: 1px solid;
            text-align: center;
            vertical-align: middle;
            line-height: 20%;
            cursor: pointer;
			color : white;
			font-size: calc(100px * 0.6);
        }
	.btn-submit {
		font-weight: lighter;
		font-size :110%;
		background-color: #000000;
		color: #ffffff;
		position: absolute;
		left: 40%;
		top: 80%;
		width: 20%;
		padding : 0.5%;
		margin: 0 auto;
		text-align: center;
		border-color: #ffffff;
	}
	.player-names{
		display: flex;
		justify-content: space-between;
		top: 5%;
	}
	</style>
</head>
<body>
    <h2 id="go_to_main" class="div-title" style="user-select:none;">PONG</h2>
    <script>
        document.getElementById("go_to_main").addEventListener("click", function() {
            localStorage.setItem('lastPage', "main-page");
            window.parent.goToMain();
        });
    </script>
    <div id="tris-game" style="display:none">
		<div id="player-names" style="display: flex; justify-content: space-between;">
			<span id="player1-name">username</span>
			<span id="player2-name">pippo</span>
			<span id="player3-name">jino</span>
			<span id="player4-name">ciao</span>
		</div>
        <table id="board"></table>
    <button onclick="resetBoard()">Reset</button>
    </div>
	<div id="bottom-board">
    <input id="player1-username-tris" type="text" style="display: none;" class="btn btn-left-top btn-block btn-lg" placeholder="username">

	<input id="player2-username-tris" type="text" style="display: none;" class="btn btn-left-bottom btn-block btn-lg" placeholder="Insert Player2 Nick">

    <input id="player3-username-tris" type="text" style="display: none;" class="btn btn-right-top btn-block btn-lg" placeholder="Insert Player3 Nick">

    <input id="player4-username-tris" type="text" style="display: none;" class="btn btn-right-bottom btn-block btn-lg" placeholder="Insert Player4 Nick">
	
	<button id="submit-username-tris" type="button" class="btn btn-submit btn-lg btn-block" style="display: none;">Submit</button>

	<button id="play-tris-1v1" type="button" class="btn-nohover btn btn-left btn-lg btn-block">Play 1v1</button>
	<button id="play-tris-tournament" type="button" class="btn-nohover btn btn-right btn-lg btn-block">Play Tournament</button>
	</div>
	<div class="open_text" style="display: none;">The game is over. The winner is: <span id="winner"></span></div>
	<button id = "NextMatch" style = "display: none;" class = "btn btn-left btn-lg btn-block"></button>
	<script>
		var board = Array(3).fill().map(() => Array(3).fill(''));
		var currentPlayer = 'X';
		var player1Name = document.getElementById('player1-name').textContent;
		var player2Name = document.getElementById('player2-name').textContent;
		var player3Name = document.getElementById('player3-name').textContent;
		var player4Name = document.getElementById('player4-name').textContent;
		var matchNumber = 1;
		var winners = [];
		var losers = [];

		function createBoard() {
			var table = document.getElementById('board');
			table.innerHTML = '';
			for (var i = 0; i < 3; i++) {
				var row = table.insertRow();
				for (var j = 0; j < 3; j++) {
					var cell = row.insertCell();
					cell.innerHTML = board[i][j];
					cell.classList.add('cell');
					cell.addEventListener('click', cellClick);
				}
			}
		}

		function cellClick() {
			var col = this.cellIndex;
			var row = this.parentNode.rowIndex;
			if (board[row][col] == '') {
				board[row][col] = currentPlayer;
				currentPlayer = currentPlayer == 'X' ? 'O' : 'X';
				createBoard();
				checkWin();
			}
		}

		function checkWin() {
			for (var i = 0; i < 3; i++) {
				if (board[i][0] == board[i][1] && board[i][1] == board[i][2] && board[i][0] != '') {
					alert(board[i][0] + ' wins!');
					handleMatchEnd(board[i][0]);
				}
				if (board[0][i] == board[1][i] && board[1][i] == board[2][i] && board[0][i] != '') {
					alert(board[0][i] + ' wins!');
					handleMatchEnd(board[0][i]);
				}
			}
			if (board[0][0] == board[1][1] && board[1][1] == board[2][2] && board[0][0] != '') {
				alert(board[0][0] + ' wins!');
				handleMatchEnd(board[0][0]);
			}
			if (board[0][2] == board[1][1] && board[1][1] == board[2][0] && board[0][2] != '') {
				alert(board[0][2] + ' wins!');
				handleMatchEnd(board[0][2]);
			}
		}

		function handleMatchEnd(winner) {
			if (matchNumber === 1) {
				alert('Match ' + matchNumber + ' winner: ' + winner);
				winners.push(winner);
				player1Name = winner;
				player2Name = '';
				matchNumber++;
				resetBoard();
				openPlayerNamesDialog();
			} else if (matchNumber === 2) {
				alert('Match ' + matchNumber + ' winner: ' + winner);
				winners.push(winner);
				player3Name = winner;
				player4Name = '';
				matchNumber++;
				resetBoard();
				openPlayerNamesDialog();
			} else if (matchNumber === 3) {
				alert('Match ' + matchNumber + ' winner: ' + winner);
				winners.push(winner);
				matchNumber++;
				resetBoard();
				openPlayerNamesDialog();
			} else if (matchNumber === 4) {
				alert('Match ' + matchNumber + ' winner: ' + winner);
				winners.push(winner);
				losers.push(player2Name);
				losers.push(player4Name);
				alert('Final standings:\n1. ' + winners[0] + '\n2. ' + winners[1] + '\n3. ' + losers[0] + '\n4. ' + losers[1]);
				resetBoard();
			}
		}

		function resetBoard() {
			board = Array(3).fill().map(() => Array(3).fill(''));
			currentPlayer = 'X';
			createBoard();
		}

		function openPlayerNamesDialog() {
			var dialog = document.getElementById('player-names-dialog');
			dialog.style.display = 'block';
		}

		function closePlayerNamesDialog() {
			var dialog = document.getElementById('player-names-dialog');
			dialog.style.display = 'none';
		}

		function openWinnerDialog(winner) {
			var dialog = document.getElementById('winner-dialog');
			var winnerSpan = document.getElementById('winner-name');
			winnerSpan.textContent = winner;
			dialog.style.display = 'block';
		}

		function closeWinnerDialog() {
			var dialog = document.getElementById('winner-dialog');
			dialog.style.display = 'none';
			resetBoard();
		}

		function startGame() {
			openPlayerNamesDialog();
		}

		function submitPlayerNames() {
			player1Name = document.getElementById('player1-name-input').value;
			player2Name = document.getElementById('player2-name-input').value;
			player3Name = document.getElementById('player3-name-input').value;
			player4Name = document.getElementById('player4-name-input').value;
			if (player1Name && player2Name && player3Name && player4Name) {
				document.getElementById('player1-name').textContent = player1Name;
				document.getElementById('player2-name').textContent = player2Name;
				document.getElementById('player3-name').textContent = player3Name;
				document.getElementById('player4-name').textContent = player4Name;
				closePlayerNamesDialog();
				createBoard();
			} else {
				alert('Please enter names for all players.');
			}
		}

		function playGame() {
			if (matchNumber === 1) {
				var winner = currentPlayer == 'X' ? player2Name : player1Name;
				openWinnerDialog(winner);
			} else if (matchNumber === 2) {
				var winner = currentPlayer == 'X' ? player4Name : player3Name;
				openWinnerDialog(winner);
			} else if (matchNumber === 3) {
				var winner = currentPlayer == 'X' ? winners[0] : winners[1];
				openWinnerDialog(winner);
			} else if (matchNumber === 4) {
				var winner = winners[0];
				openWinnerDialog(winner);
			}
		}

		createBoard();
	</script>
	</script>

	<div id="player-names-dialog" class="dialog" style="display: none;">
    </script>
</body>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
	window.onload = function(){
document.getElementById("play-tris-tournament").addEventListener("click", function(){
	document.getElementById("play-tris-1v1").style.display = "none";
    document.getElementById("play-tris-tournament").style.display = "none";
	document.getElementById("player1-username-tris").style.display = "block";
    document.getElementById("player2-username-tris").style.display = "block";
    document.getElementById("player3-username-tris").style.display = "block";
    document.getElementById("player4-username-tris").style.display = "block";
    document.getElementById("submit-username-tris").style.display = "block";
});
//Funzione per cambiare il nick dell'user2 nel gioco tris
document.getElementById("submit-username-tris").addEventListener("click", function() {
    var username2 = document.getElementById("player2-username-tris").value;
	var username3 = document.getElementById("player3-username-tris").value;
	var username4 = document.getElementById("player4-username-tris").value;

    if (username2 && username3 && username4) {
    	//Save the username2 for player 2
		document.getElementById("player2-name").textContent = username2;
		document.getElementById("player3-name").textContent = username3;
		document.getElementById("player4-name").textContent = username4;
	 	//Hide the input field
		document.getElementById("player1-username-tris").style.display = "none";
		document.getElementById("player2-username-tris").style.display = "none";
		document.getElementById("player3-username-tris").style.display = "none";
		document.getElementById("player4-username-tris").style.display = "none";
		document.getElementById("submit-username-tris").style.display = "none";
        //Start the game
		document.getElementById("tris-game").style.display = "block";
		document.getElementById("bottom-board").style.display = "none";
    } else {
		if(!username2){
        	alert("Please enter a username for player 2.");
		}
		if(!username3){
			alert("Please enter a username for player 3.");
    	}
		if(!username4){
			alert("Please enter a username for player 4.");
		}
	}
});
}
</script>
</html>
