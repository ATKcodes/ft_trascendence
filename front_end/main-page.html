<html lang="en">
  <head>
    <!-- Bootstrap CSS -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <title>PONG</title>
    <style>
      .select-language{
        background-color: #B6A999;
        color: #000000;
        position: absolute;
        right: 8%;
        top: 5%;
        width: 4%;
        padding : 0.5%;
        margin: 0 auto;
        text-align: left;
      }
      .div-friends{
        position: absolute;
        right: 3%;
        bottom: 5%;
        width: 20%;
        padding : 0.5%;
        margin: 0 auto;
        text-align: center;
      
      }
      .div-title {
          font-family: 'font-Despairs';
          font-size: 500%; /* Change this to move the div horizontally */
          position: absolute;
          left: 45%; /* Change this to move the div horizontally */
          right: 2%;
          top: 3%; /* Change this to move the div vertically */
          width: 15%;
          padding : 1%;
          color: black;
        }
      .div-friendsmenu {
        position: absolute;
        right: 5%;
        bottom: 3%;
        width: 15%;
        height: 40%;
        padding : 1%;
        margin: 0 auto;
        text-align: center;
        background-color: #B6A999;
      }
      .game 
      {
        position: absolute;
        width: 96%;
        height: 75%;
        left: 2%;
        right: 2%;
        top: 20%;
        bottom: 10%;
        background-color: #000000;
        color: #ffffff;
      }
      .btn-primary {
        font-weight: lighter;
        font-size :110%;
        background-color: #000000;
        color: #ffffff;
        position: absolute;
        left: 40%;
        top: 45%;
        width: 20%;
        padding : 0.5%;
        margin: 0 auto;
        text-align: center;
        border-color: #ffffff;
      }
      .open_text {
        font-size: 200%;
        text-align: center;
        position: absolute;
        width: 60%;
        height: 75%;
        left: 20%;
        right: 2%;
        top: 20%;
        bottom: 10%;
        background-color: #000000;
        color: #ffffff;
      }
      .select {
        background-image: url('download.jpeg');
        border-radius: 50%;
        color: #000000;
        position: absolute;
        left: 3%;
        top: 5%;
        padding : 0.5%;
        margin: 0 auto;
        text-align: left;
      }
      .navbar {
        padding: 10px;
        background: #000;
        position: fixed;
        top: 30px;
        left: 30px;
        z-index: 90;
        cursor: pointer;
      }
      .icon-bar {
        background-image: url('download.jpeg');
        border-radius: 50%;
        color: #000000;
        position: absolute;
        left: 3%;
        top: 5%;
        padding : 0.5%;
        margin: 0 auto;
        text-align: left;
      }
	  /* Style the navigation menu 
	 	Possible color palette : 
		#DFA100 Main Yellow/Orange Color rgba(223, 161, 0, 1)
		#c68f00 Light Yellow/Orange Color rgba(198, 143, 0, 1)
		#ac7c00 Dark Yellow/Orange Color rgba(172, 124, 0, 1)
		#936a00 Darker Yellow/Orange Color rgba(147, 106, 0, 1)
		#B6A999 Light Gray Color rgba(182, 169, 153, 1)
		#4F4537 Dark Brown Color rgba(79, 69, 55, 1)
		#ffffff White Color rgba(255, 255, 255, 1)
		#000000 Black Color (0, 0, 0, 1)
	  */
	  nav {
		width: 20%;
		height: 100%;
		position: fixed;
		top: 0;
		left: 0;
		background: linear-gradient(to right, rgba(198, 143, 0, 1), rgba(198, 143, 0, 0.94)), url('your-background-image.jpg');
		background-size: cover;
		z-index: 69;
		transition: .3s;
		transform: translateX(-100%);
		border-right: 1px solid #000;
	}
      .wide{
        transform: translateX(0);
      }
      nav ul {
        list-style: none;
        padding: 60px;		
      }
      nav li {
        font-size: 30px;
        color: #ffffff;
      }
	  .online, .offline {
		display: inline-block;
		width: 10px;
		height: 10px;
		border-radius: 50%;
	}

	.online {
		background-color: rgb(3, 194, 3);
	}

	.offline {
		background-color: rgb(248, 26, 26);
	}
		</style>
    <!-- Bootstrap JS -->
  </head>
  <body>
    <div class="navbar">
      <img class="icon-bar"></img>
    </div>
    <nav class="nav">
		<ul>
			<li id="Username" style="margin-top: 10%; font-size: 50px;">User</li>
			<li id="go_to_profile" style="margin-top: 5%;">Profile</li>
			<li style="margin-top: 5%; display: flex; align-items: center;">
				<span id="amici">Friends</span>
				<button id="addFriend" class="btn" style="font-size: 15px; margin-left: 25%; background-color: #000; color:#ffffff">addFriend</button>
			</li>
			<li id="noFriends" style = "display: none; margin-top:5%; font-size: 22px;">No friends to display yet</li>
			<li id="friendsList" style="margin-top: 5%;"></li> <!-- New element for the friends list -->
			<li id = "go_to_login"style="margin-top: 250%;">Logout</li>
		</ul>
    </nav>
    <h2 class="div-title">PONG</h2>
	<select id = "select-language"class="select-language rounded-pill">
	<option value="EN">EN</option>
	<option value="IT">IT</option>
	<option value="ES">ES</option>
	</select>
    <div class="game">
      <button id = "go_to_game" type="button" class="btn btn-primary btn-lg btn-block">Play</button>
    </div>
  </body>
  <script>
  	document.addEventListener('DOMContentLoaded', (event) => {
		// Seleziona l'elemento select
		var selectLanguage = document.querySelector('.select-language');

		// Aggiungi un event listener per l'evento 'change'
		selectLanguage.addEventListener('change', function() {
		// Quando l'utente seleziona una nuova lingua, salvala nel localStorage
		localStorage.setItem('language', this.value);
		console.log('Language changed to:', this.value);
		window.parent.userInstance.changeLanguage(this.value);
		console.log("User language = "+window.parent.userInstance.language);
		var language = JSON.stringify( {language: this.value});
		var token = localStorage.getItem('userToken');

		fetch('http://localhost:8001/main/language/', {
				method: 'POST',
				headers: {
					'Authorization' : 'Token ' + token,
					'Content-Type': 'application/json'
				},
				body: language,
			}).then(response => {
				if (response.ok) {
					console.log('Language change sent successfully');
				} else {
					console.error('Error sending language change:', response.statusText);
				}
			}).catch(error => {
				console.error('Network error:', error);
			});
		// Aggiorna il testo sulla pagina
		updateText(this.value);
  	});
	// Add an event listener for the custom event
	window.addEventListener('message', function(event) {
    // Check the type of the message
    if (event.data.type === 'userDataLoaded') {
        console.log('userDataLoaded event triggered');
        // Access the userInstance from the parent window
        document.getElementById('Username').textContent = window.parent.userInstance.username;

		// Change the selected language
		var languageSelect = document.getElementById('select-language'); // Replace 'languageSelect' with the ID of your select element
        languageSelect.value = window.parent.userInstance.language;
		
		// Get the container where you want to display the friends
		var container = document.getElementById('friendsList');
		// Get the list of friends
		var friends = window.parent.userInstance.friendlists;
		// Check if the friends list is not undefined and not empty
// Check if the friends list is not undefined and not empty
	if (friends && friends.length > 0) {
		// Limit the number of friends to display
		var maxFriends = 10; // Change this to the maximum number of friends you want to display
		friends = friends.slice(0, maxFriends);

		// Create an HTML element for each friend and append it to the container
		for (var i = 0; i < friends.length; i++) {
			var friendElement = document.createElement('p');
			friendElement.textContent = friends[i].name; // Change this to display the friend's name or other property

			// Create a span element for the online status indicator
			var statusIndicator = document.createElement('span');
			statusIndicator.className = friends[i].online ? 'online' : 'offline'; // Replace 'online' and 'offline' with the classes that set the color of the indicator
			statusIndicator.style.marginLeft = '10px'; // Add some space between the name and the indicator

			// Append the status indicator to the friend element
			friendElement.appendChild(statusIndicator);

			// Add an event listener to the friend element that calls goToFriendProfile() when clicked
			friendElement.addEventListener('click', function() {
				goToFriendProfile(friends[i].id); // Replace friends[i].id with the friend's unique identifier
			});

			container.appendChild(friendElement);
		}
	} else {
		// Display a message if there are no friends to display
		document.getElementById('noFriends').style.display = 'block';
	}
};
});

	function updateText(language) {
		if (language == 'IT') {
		document.getElementById('addFriend').innerText = 'Aggiungi Amico';
		document.getElementById('go_to_profile').innerText = 'Profilo';
		document.getElementById('amici').innerText = 'Amici';
		document.getElementById('go_to_login').innerText = 'Esci';
		document.getElementById('go_to_game').innerText = 'Gioca';
		document.getElementById('noFriends').innerText = 'Non hai ancora nessun amico :\(';
		} else if (language == 'EN') {
		document.getElementById('addFriend').innerText = 'Add Friend';
		document.getElementById('go_to_profile').innerText = 'Profile';
		document.getElementById('amici').innerText = 'Friends';
		document.getElementById('go_to_login').innerText = 'Logout';
		document.getElementById('go_to_game').innerText = 'Play';
		document.getElementById('noFriends').innerText = 'No friends to display yet :\(';
		} else if (language == 'ES') {
		document.getElementById('addFriend').innerText = 'Añadir Amigo';
		document.getElementById('go_to_profile').innerText = 'Perfil';
		document.getElementById('amici').innerText = 'Amigos';
		document.getElementById('go_to_login').innerText = 'Salir';
		document.getElementById('go_to_game').innerText = 'Jugar';
		document.getElementById('noFriends').innerText = 'Aún no tienes amigos :\(';
		}
	}
	// Aggiorna il testo sulla pagina con la lingua salvata nel localStorage quando la pagina viene caricata
	var savedLanguage = localStorage.getItem('language');
	if (savedLanguage) {
		updateText(savedLanguage);
	}
	});
    document.getElementById("go_to_login").addEventListener("click", function() {
		window.parent.userInstance.resetData();
        localStorage.setItem('lastPage', "login");
		localStorage.setItem('userToken', '');
        window.parent.goToLogin();
        });
	document.getElementById("go_to_profile").addEventListener("click", function() {
        localStorage.setItem('lastPage', "profile");
        window.parent.goToProfile();
      });
	document.getElementById("go_to_game").addEventListener("click", function() {
	  localStorage.setItem('lastPage', "profile");
	  window.parent.goToGame();
	});
	//Aggiungere qui la chiamata al backend per l'aggiunta di un amico
	document.getElementById("addFriend").addEventListener("click", function() {
	});


  </script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $(document).ready(function(){
      $('.navbar').click(function(){
        $('.nav').toggleClass('wide');
      });
    });
    let variabileBooleana = false;
  
    document.getElementById('amici').addEventListener('click', function() {
      variabileBooleana = !variabileBooleana;
      console.log(variabileBooleana);
  });
    </script>
</html>
